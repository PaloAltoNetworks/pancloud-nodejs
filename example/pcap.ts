import { util } from 'pancloud-nodejs'
import { writeFileSync } from 'fs'

let example = { "container": 0, "risk-of-app": "4", "logset": "lcaas", "natsport": 0, "sessionid": 27478, "url_denied": 0, "type": "threat", "url_idx": 2, "parent_start_time": 0, "characteristic-of-app": ["able-to-transfer-file", "has-known-vulnerability", "tunnel-other-application", "prone-to-misuse", "is-saas"], "dg_hier_level_4": 0, "http_method": "unknown", "dg_hier_level_1": 0, "dg_hier_level_3": 0, "dg_hier_level_2": 0, "action": "alert", "recsize": 3421, "from": "TAPZONE", "parent_session_id": 0, "repeatcnt": 1, "app": "web-browsing", "vsys": "vsys1", "nat": 0, "technology-of-app": "browser-based", "pbf_s2c": 0, "pbf_c2s": 0, "receive_time": 1548759463, "non-standard-dport": 0, "subcategory-of-app": "internet-utility", "pcap_id": 1204889238391226400, "users": "10.10.108.11", "ppid": -1, "captive_portal": 0, "is_gpaas": 0, "proxy": 0, "fwd": 1, "log_feat_bit1": 1, "config_ver": 2049, "cloud_hostname": "PA-VM", "is_fwaas": 0, "customer-id": "........", "is_dup_log": 0, "proto": "tcp", "non_std_dport": 0, "tunneled-app": "tunneled-app", "recon_excluded": 0, "is-saas-of-app": 0, "sig_flags": 0, "natdport": 0, "flag": 0, "dst": "195.208.1.108", "reportid": 0, "natdst": "0.0.0.0", "flags": -2147475456, "rule": "MonitorAll", "decrypt_mirror": 0, "contentver": 531829896, "dport": 80, "sanctioned-state-of-app": 0, "category-of-threatid": "unknown", "inbound_if": "ethernet1/1", "device_name": "PA-VM", "mptcp_on": 0, "ui-contentver": "AppThreat-8115-5256", "subtype": "vulnerability", "time_received": 1548759452, "actionflags": -6917529027641082000, "tunnelid_imsi": 0, "pcap": "AQADsgAABCAQuKBg6AAAYlxQMZ0AIwAjAA4AIgN8BZoAFAABAAmXLHoAACFZJ30MCABFAAWMZsBAADMGoFrD0AFsCgpsCwBQyZtmSziT4tS9y1AQAB+rmQAASFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54LzEuMTIuMg0KRGF0ZTogVHVlLCAyOSBKYW4gMjAxOSAxMDo1NzozMyBHTVQNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KQ29udGVudC1MZW5ndGg6IDE4OTQ3DQpDb25uZWN0aW9uOiBrZWVwLWFsaXZlDQpMYXN0LU1vZGlmaWVkOiBUdWUsIDExIEp1bCAyMDE3IDIxOjI3OjM4IEdNVA0KRVRhZzogIjRhMDMtNTU0MTE1ZTZhODIwMCINCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQoNCgovKgogKiBqUXVlcnkgVG9vbHMgMS4yLjUgLSBUaGUgbWlzc2luZyBVSSBsaWJyYXJ5IGZvciB0aGUgV2ViCiAqCiAqIFtkYXRlaW5wdXQsIHJhbmdlaW5wdXQsIHZhbGlkYXRvcl0KICoKICogTk8gQ09QWVJJR0hUUyBPUiBMSUNFTlNFUy4gRE8gV0hBVCBZT1UgTElLRS4KICoKICogaHR0cDovL2Zsb3dwbGF5ZXIub3JnL3Rvb2xzLwogKgogKiBGaWxlIGdlbmVyYXRlZDogV2VkIEphbiAxMiAyMzoxMjoyMiBHTVQgMjAxMQogKi8KKGZ1bmN0aW9uKGQpe2Z1bmN0aW9uIFIoYSxjKXtyZXR1cm4gMzItKG5ldyBEYXRlKGEsYywzMikpLmdldERhdGUoKX1mdW5jdGlvbiBTKGEsYyl7YT0iIithO2ZvcihjPWN8fDI7YS5sZW5ndGg8YzspYT0iMCIrYTtyZXR1cm4gYX1mdW5jdGlvbiBUKGEsYyxqKXt2YXIgcT1hLmdldERhdGUoKSxoPWEuZ2V0RGF5KCkscj1hLmdldE1vbnRoKCk7YT1hLmdldEZ1bGxZZWFyKCk7dmFyIGY9e2Q6cSxkZDpTKHEpLGRkZDpCW2pdLnNob3J0RGF5c1toXSxkZGRkOkJbal0uZGF5c1toXSxtOnIrMSxtbTpTKHIrMSksbW1tOkJbal0uc2hvcnRNb250aHNbcl0sbW1tbTpCW2pdLm1vbnRoc1tyXSx5eTpTdHJpbmcoYSkuc2xpY2UoMikseXl5eTphfTtjPWMucmVwbGFjZShYLGZ1bmN0aW9uKHMpe2E3ZWEzOTRiNjgyY2E3YjVjZDM5MDgzZDc3OWFiZDINCg0KYWZ0ZXJMb2FkKCk7DQoJCQl9LCAxKTsNCgkJfSk7DQoJfTtLf+f6", "sym_return": 0, "name-of-threatid": "JavaScriptObfuscationDetected", "direction": "server-to-client", "misc": "elka-barrier.ru/custom/themes/default/jquery.tools.js", "threatid": 54261, "severity": "informational", "exported": 0, "natsrc": "0.0.0.0", "seqno": 20453797, "src": "10.10.108.11", "time_generated": 1548759452, "outbound_if": "ethernet1/1", "category-of-app": "general-internet", "srcloc": "10.0.0.0-10.255.255.255", "dstloc": "RU", "tunnel_inspected": 0, "serial": "", "vsys_id": 1, "ui-srcloc": "10.0.0.0-10.255.255.255", "to": "TAPZONE", "category": "business-and-economy", "sport": 51611, "packet_capture": 1, "tunnel": 0, "ui-dstloc": "RussianFederation", "transaction": 0, "is_phishing": 0 }
let pcapBody = util.pcaptize(example)
if (pcapBody) {
    writeFileSync('pcap.pcap', pcapBody)
    console.log("PCAP data saved as 'pcap.pcap'")
} else {
    console.log("Event without PCAP data")
}